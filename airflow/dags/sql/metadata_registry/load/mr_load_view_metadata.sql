INSERT INTO dds.entity (loaded_by_eid, entity_type_etid, entity_name, entity_name_short, urn, parent_eid, info,
                        search_data, json_data, json_data_ui, codes, htmls, links, notifications, tables, tags)
VALUES ((SELECT eid FROM dds.entity WHERE dds.entity.urn = 'datacatalog.airflow.etl.{{ params.exporter_name }}' LIMIT 1),
        (SELECT etid FROM  dds.entity_types WHERE entity_type_name = 'view' LIMIT 1),
        '{{ params.entity_name }}',
        '{{ params.entity_name_short }}',
        '{{ params.urn }}',
        (SELECT eid FROM dds.entity WHERE dds.entity.urn = '{{ params.parent_urn }}' LIMIT 1),
        'View at {{ params.source_name }} {{ params.hostname }} instance',
        '{{ params.entity_name_short }}',
        '{{ params.json_data }}',
        '{{ params.json_data_ui }}',
        '{{ params.codes }}',
        NULL, NULL, NULL,
        '{{ params.tables }}',
        '{"{{ params.source_name }}", "table", "view"}')
  ON CONFLICT (urn)  DO UPDATE SET loaded_by_eid = (SELECT eid FROM dds.entity WHERE dds.entity.urn = 'datacatalog.airflow.etl.{{ params.exporter_name }}' LIMIT 1),
                          entity_type_etid = (SELECT etid FROM  dds.entity_types WHERE entity_type_name = 'view' LIMIT 1),
                          entity_name = '{{ params.entity_name }}',
                          entity_name_short = '{{ params.entity_name_short }}',
                          parent_eid = (SELECT eid FROM dds.entity WHERE dds.entity.urn = '{{ params.parent_urn }}' LIMIT 1),
                          info = 'View at {{ params.source_name }} {{ params.hostname }} instance',
                          search_data = '{{ params.entity_name_short }}',
                          json_data = '{{ params.json_data }}',
                          json_data_ui = '{{ params.json_data_ui }}',
                          codes = '{{ params.codes }}',
                          htmls = NULL,
                          links = NULL,
                          notifications = NULL,
                          tables = '{{ params.tables }}',
                          tags = '{"{{ params.source_name }}", "table", "view"}'
WHERE dds.entity.urn = '{{ params.urn }}';